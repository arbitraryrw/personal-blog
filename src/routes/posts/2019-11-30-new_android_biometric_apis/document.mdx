import styles from './document.module.css'

import face_prompt_1 from './imgs/face_prompt_1.png'
import face_prompt_2 from './imgs/face_prompt_2.png'
import face_prompt_3 from './imgs/face_prompt_3.png'
import face_prompt_error from './imgs/face_prompt_error.png'
import face_prompt_confirmation_not_required_1 from './imgs/face_prompt_confirmation_not_required_1.png'
import face_prompt_confirmation_not_required_2 from './imgs/face_prompt_confirmation_not_required_2.png'
import finger_prompt_1 from './imgs/finger_prompt_1.png'


<div className={styles["blogBody"]}>

# Introduction
android

<img src={face_prompt_1} className={styles["screenshot"]} alt="Facial recognition prompt" />

## Background

```kotlin
val biometricManager = BiometricManager.from(this)
when (biometricManager.canAuthenticate()) {
    BiometricManager.BIOMETRIC_SUCCESS ->
        // Perform post authentication logic
    BiometricManager.BIOMETRIC_ERROR_NO_HARDWARE ->
        println("No biometric features available on this device.")
    BiometricManager.BIOMETRIC_ERROR_HW_UNAVAILABLE ->
        println("Biometric features are currently unavailable.")
    BiometricManager.BIOMETRIC_ERROR_NONE_ENROLLED ->
        println("User has no biometrics with their account.")
}
```

For further information on what each authentication response means refer to the developer docs [here](https://developer.android.com/reference/androidx/biometric/BiometricManager.html#constants_1).


```kotlin
fun showBiometricPrompt() {
    val promptInfo = BiometricPrompt.PromptInfo.Builder()
        .setTitle("Biometric Example")
        .setDescription("Biometric login for my app")
        .setSubtitle("Log in using your biometric credential")
        .setNegativeButtonText("Abort biometric login")
        .setConfirmationRequired(false)
        .setDeviceCredentialAllowed(false)
        .build()
...
}
```


```kotlin
val biometricPrompt = BiometricPrompt(this, executor,
    object : BiometricPrompt.AuthenticationCallback() {
        override fun onAuthenticationError(errorCode: Int,
                                           errString: CharSequence) {
            super.onAuthenticationError(errorCode, errString)
            Toast.makeText(applicationContext,
                "Authentication error: $errString", Toast.LENGTH_SHORT)
                .show()

            if (errorCode == BiometricPrompt.ERROR_NEGATIVE_BUTTON){
                println("Error: negative button pressed.")
            }

            println("AUTH ERROR")
        }

        override fun onAuthenticationSucceeded(
            result: BiometricPrompt.AuthenticationResult) {
            super.onAuthenticationSucceeded(result)
            val authenticatedCryptoObject: BiometricPrompt.CryptoObject? =
                result.getCryptoObject()
            // User has verified the signature, cipher, or message
            // authentication code (MAC) associated with the crypto object,
            // so you can use it in your app's crypto-driven workflows.

            val authResultTextView = findViewById<TextView>(R.id.authResultTextView)

            println("[+] Successful authentication, yahoo!")

            authResultTextView.setText(Successfully Authenticated")
        }

        override fun onAuthenticationFailed() {
            super.onAuthenticationFailed()
            Toast.makeText(applicationContext, "Authentication failed",
                Toast.LENGTH_SHORT)
                .show()

            println("Biometric auth failed")
        }
    })

// Displays the "log in" prompt.
biometricPrompt.authenticate(promptInfo)

```


The full source code can be found on my Github [here](https://github.com/arbitraryrw/biometric-prompt-demo/). Additionally, Google provides a useful tutorial for integrating the new Biometric APIs which can be found [here](https://developer.android.com/training/sign-in/biometric-auth).

# References and Further Reading
- [Android - Biometric Security Overview](https://source.android.com/security/biometric)
- [Android - Measuring Biometric Security](https://source.android.com/security/biometric/measure#metrics)
- [Google Source - Biometric Classes](https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/hardware/biometrics)
- [Developer Docs - BiometricManager](https://developer.android.com/reference/androidx/biometric/BiometricManager)
- [Developer Docs - BiometricPrompt](https://developer.android.com/reference/android/hardware/biometrics/BiometricPrompt)
- [Developer Docs - Basic Integration Guide](https://developer.android.com/training/sign-in/biometric-auth)

</div>
